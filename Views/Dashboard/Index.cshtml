@using WorkforceScheduler.Models
@using System.Linq

@{
    ViewData["Title"] = "Dashboard";
    var employees = (ViewBag.Employees as IEnumerable<Employee>) ?? Enumerable.Empty<Employee>();
    var shifts = (ViewBag.Shifts as IEnumerable<Shifts>) ?? Enumerable.Empty<Shifts>();
}

<!-- Add Employee Button (top) -->
<button onclick="openModal('employeeModal')" 
        class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
    + Add Employee
</button>

<!-- Employee Modal (single, functional) -->
<div id="employeeModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-96">
        <h3 class="text-lg font-bold mb-4">Add Employee</h3>
        <form method="post" asp-action="AddEmployee">
            @Html.AntiForgeryToken()
            <div class="mb-3">
                <label class="block text-sm font-medium mb-1">Name</label>
                <input asp-for="Name" type="text" class="w-full p-2 border rounded" required />
                <span asp-validation-for="Name" class="text-red-500 text-xs"></span>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium mb-1">Role</label>
                <input asp-for="Role" type="text" class="w-full p-2 border rounded" required />
                <span asp-validation-for="Role" class="text-red-500 text-xs"></span>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium mb-1">Shift</label>
                <select asp-for="ShiftId" class="w-full p-2 border rounded" required>
                    <option value="">Select Shift</option>
                    @if (shifts.Any())
                    {
                        @foreach(var shift in shifts)
                        {
                          <option value="@shift.Id">@shift.Name (@(shift.StartTime?.ToString(@"hh\:mm") ?? "N/A") - @(shift.EndTime?.ToString(@"hh\:mm") ?? "N/A"))</option>
                        }
                    }
                    else
                    {
                        <option disabled>No shifts available</option>
                    }
                </select>
            </div>
            <div class="flex justify-end space-x-3">
                <button type="button" onclick="closeModal('employeeModal')" 
                        class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
                <button type="submit" 
                        class="px-4 py-2 bg-indigo-600 text-white rounded">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Top Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="bg-indigo-600 text-white p-6 rounded-xl shadow flex items-center justify-between">
        <div>
            <h3 class="text-lg font-bold">Employees</h3>
            <p class="text-2xl mt-2">@employees.Count()</p>
        </div>
        <div class="text-white text-4xl">ðŸ‘¤</div>
    </div>
    <div class="bg-green-500 text-white p-6 rounded-xl shadow flex items-center justify-between">
        <div>
            <h3 class="text-lg font-bold">Shifts</h3>
            <p class="text-2xl mt-2">@shifts.Count()</p>
        </div>
        <div class="text-white text-4xl">ðŸ•’</div>
    </div>
    <div class="bg-yellow-500 text-white p-6 rounded-xl shadow flex items-center justify-between">
        <div>
            <h3 class="text-lg font-bold">Active Tasks</h3>
            <p class="text-2xl mt-2">12</p>  <!-- Make dynamic if needed -->
        </div>
        <div class="text-white text-4xl">âš¡</div>
    </div>
</div>

<!-- Employees Table -->
<div class="bg-white p-6 rounded-xl shadow mb-8">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-indigo-600">Employees</h2>
        <button onclick="openModal('employeeModal')" 
                class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
            + Add Employee
        </button>
    </div>
    @if (employees.Any())
    {
        <table class="min-w-full border border-gray-200 rounded-lg">
            <thead class="bg-indigo-100">
                <tr>
                    <th class="py-2 px-4 border">Name</th>
                    <th class="py-2 px-4 border">Role</th>
                    <th class="py-2 px-4 border">Shift</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var emp in employees)
                {
                    <tr class="hover:bg-gray-50">
                        <td class="py-2 px-4 border">@emp.Name</td>
                        <td class="py-2 px-4 border">@emp.Role</td>
                        <td class="py-2 px-4 border">@(emp.Shift?.Name ?? "Unassigned")</td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p class="text-gray-500">No employees yet. Add one above!</p>
    }
</div>

<!-- Shifts Table -->
<div class="bg-white p-6 rounded-xl shadow mb-8">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-indigo-600">Shifts</h2>
        <button onclick="openModal('shiftModal')" 
                class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
            + Add Shift
        </button>
    </div>
    @if (shifts.Any())
    {
        <table class="min-w-full border border-gray-200 rounded-lg">
            <thead class="bg-indigo-100">
                <tr>
                    <th class="py-2 px-4 border">Name</th>
                    <th class="py-2 px-4 border">Start</th>
                    <th class="py-2 px-4 border">End</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var shift in shifts)
                {
                    <tr class="hover:bg-gray-50">
                        <td class="py-2 px-4 border">@shift.Name</td>
                        <td class="py-2 px-4 border">@(shift.StartTime?.ToString(@"hh\:mm") ?? "N/A")</td>
                        <td class="py-2 px-4 border">@(shift.EndTime?.ToString(@"hh\:mm") ?? "N/A")</td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p class="text-gray-500">No shifts yet. Add one above!</p>
    }
</div>

<!-- Shift Modal -->
<div id="shiftModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-96">
        <h3 class="text-lg font-bold mb-4">Add Shift</h3>
        <form method="post" asp-action="AddShift">
            @Html.AntiForgeryToken()
            <div class="mb-3">
                <label class="block text-sm font-medium mb-1">Name</label>
                <input asp-for="Name" type="text" class="w-full p-2 border rounded" required />
                <span asp-validation-for="Name" class="text-red-500 text-xs"></span>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium mb-1">Start Time</label>
                <input asp-for="StartTime" type="time" class="w-full p-2 border rounded" required />
                <span asp-validation-for="StartTime" class="text-red-500 text-xs"></span>
            </div>
            <div class="mb-3">
                <label class="block text-sm font-medium mb-1">End Time</label>
                <input asp-for="EndTime" type="time" class="w-full p-2 border rounded" required />
                <span asp-validation-for="EndTime" class="text-red-500 text-xs"></span>
            </div>
            <div class="flex justify-end space-x-3">
                <button type="button" onclick="closeModal('shiftModal')" 
                        class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
                <button type="submit" 
                        class="px-4 py-2 bg-indigo-600 text-white rounded">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Consolidated JavaScript -->
<script>
    function openModal(id) {
        document.getElementById(id).classList.remove('hidden');
    }
    function closeModal(id) {
        document.getElementById(id).classList.add('hidden');
    }
</script>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}